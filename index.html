<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyScript with Janome</title>
    <!-- PyScript読み込み -->
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css">
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
    <h1>Janomeで形態素解析を実行</h1>
    <p>結果が出るまで結構時間がかかるっぽいです。</p>
    <p>（毎回ページを読み込むたびにjanomeをインストールしているため）</p>

    <!-- テキスト入力エリア -->
    <textarea id="text-input" rows="4" cols="50" placeholder="ここに日本語を入力してください"></textarea>
    <button id="analyze-button">形態素解析を実行</button>

    <!-- 結果表示エリア -->
    <div id="output"></div>

    <!-- Pythonコード -->
    <py-script>
        import asyncio
        from pyscript import Element
        import micropip

        async def main():
            # Janomeをインストール
            await micropip.install("janome")

            from janome.tokenizer import Tokenizer
            tokenizer = Tokenizer()

            # ボタンが押されたときのイベント
            def analyze_text(event):
                text = Element("text-input").element.value
                tokens = [token.surface for token in tokenizer.tokenize(text)]
                Element("output").write(", ".join(tokens))

            # ボタンにイベントをバインド
            Element("analyze-button").element.onclick = analyze_text

        # asyncioを使って非同期タスクをスケジュール
        asyncio.ensure_future(main())
    </py-script>
</body>
</html>
